{% extends 'reviews/base.html' %}
{% block allreviews %}{{ block.super }}{% endblock %}
{% block allreviewers %}{{ block.super }}{% endblock %}
{% block loginout %}{{ block.super }}{% endblock %}

{% block title %}
    {{ block.super }}: All Comics
{% endblock %}

{% block allcomics %}
    {{ block.super }}
    <script>$( "#menubtn_allcomics" ).button({  disabled: true });</script>
{% endblock %}

{% block content %}
    {% if user and user.is_active %}
        <a href="{% url 'addcomic' %}" class="addcomiclink">Add A Comic</a>
        <br />
    {% endif %}
    {% if comic_list %}
        <table class="comicslist" id="comicslist"></table>
        <script>
            tableid = "comicslist";
            $(document).ready(function() {
                $('#'+tableid).dataTable({
                    "sPaginationType" : "full_numbers",
                    "iDisplayLength"  : 15,
                    "bLengthChange"   : false,
                    "fnDrawCallback"  : function(){
                            if ( $('#'+tableid+'_paginate span a.paginate_button').size() ) {
                                $('#'+tableid+'_paginate')[0].style.display = "block";
                            } else {
                                $('#'+tableid+'_paginate')[0].style.display = "none";
                            }
                        },                    
                    {% if user and user.is_active %}
                        "aaSorting" : [[2, 'asc']],
                    {% else %}
                        "aaSorting" : [[1, 'asc']],
                    {% endif %}
                    "aoColumns" : [
                        {% if user and user.is_active %}
                            {'sTitle' : 'Tasks'},
                        {% endif %}
                        {'sTitle' : 'Avg. Stars'},
                        {'sTitle' : 'Name'},
                        {'sTitle' : 'Reviews'},
                        {'sTitle' : 'Content'},
                        {'sTitle' : 'Read Comic'},
                    ],
                    "aaData" : [
                        {% for comic in comic_list %}
                        [
                            {% with avg=comic.average_rating count=comic.review_set.count %}
                                {% if user and user.is_active %}
                                        '<a href="{% url 'editcomic' comic.id %}">(edit)</a><a href="{% url 'deletecomic' comic.id %}">(delete)</a>',
                                {% endif %}
                                '<span class="rateit" data-rateit-value="{{ avg }}" data-rateit-ispreset="true" data-rateit-readonly="true"></span>{{ avg }}',
                                '{{ comic.name }}',
                                '<a href="{% url 'comicdetail' comic.id %}">{{ count }} review{{ count|pluralize }}</a>',
                                '{{ comic.get_mpaa_rating_display }}',
                                '<a href="{{ comic.url }}">First Strip</a>',
                            {% endwith %}
                        ],
                        {% endfor %}
                    ],
                });
                $(".rateit").rateit();
            } );
        </script>
    {% else %}
        <p>No comics are available.</p>
    {% endif %}
{% endblock %}

